{% extends "base.html" %}

{% block main_id %}p-index{% endblock %}

{% block head %}
    <link rel="stylesheet" href="/static/css/index.css">
{% endblock %}

{% block main %}
    <a id="g-hero" href="/"></a>

    {% match current_basho %}
    {% when Some with (basho) %}
        <section id="next-basho">
            <a href="{{basho.link_url()}}">
                <img class="button-link"
                    alt="Enter current tournament"
                    src="/static/img2/2021-Current-Tournament.png"
                    width="1801" height="388">
            </a>
            {% if !basho.has_started() %}
                <p>
                    Time remaining to enter your picks:
                    <span class="js-basho-count-down" data-start-date="{{basho.start_date.timestamp_millis()}}"></span>
                </p>
            {% endif %}
        </section>
    {% when None %}
        {% if base.is_admin() %}
            <p>Admin: <a href="{{next_basho_id.url_path()}}/edit">enter banzuke for {{next_basho_id}}</a></p>
        {% endif %}
    {% endmatch %}

    {% match prev_basho %}
    {% when Some with (basho) %}
        <section id="prev-winners">
            <h2>
                <a href="{{basho.link_url()}}">
                    <img src="/static/img2/2021-Basho-Champion.png"
                        width="1801" height="448"
                        alt="Congratulations to the previous basho champion">
                </a>
            </h2>
            <span class="winners">
                {% for player in basho.winners -%}
                    {{player.render().unwrap()|safe}}
                    {%- if !loop.last %}, {% endif -%}
                {%- endfor %}
            </span>
        </section>
    {% when None %}
    {% endmatch %}

    <section id="leaderboard">
        <picture class="background">
            <source src="/static/img2/2021-Player-Rankings.webp" type="image/webp">
            <img src="/static/img2/2021-Player-Rankings.png" width="1059" height="1301">
        </picture>
        
        <div class="scroll-container">
            <div class="grid">
            {% for (rank, players) in self.leaders_by_rank() %}
                <div class="group {{rank.side}}">
                    <h3>{{"{:#}"|format(rank)}}</h3>
                    <ol class="players">
                    {% for player in players %}
                        <li>
                            <span class="ord">
                                {{-player.ord-}}
                            </span>
                            <span class="player">
                                {{player.player.render().unwrap()|safe}}
                            </span>
                            <span class="wins">
                                {%- call numeric_stat(player.wins.total) -%}
                            </span>
                        </li>
                    {% endfor %}
                    </ol>
                </div>
            {% endfor %}
            </div>

            <p>
                Rankings are based on total wins over the past 6 basho (one year).
            </p>

            <a class="all-stats" href="/stats">All player stats</a>
        </div>
    </section>
{% endblock %}

{%- macro numeric_stat(opt_num) -%}
    {%- match opt_num -%}
    {%- when Some with (num) -%} {{"{:.1}"|format(num)}}
    {%- when None -%}
    {%- endmatch -%}
{%- endmacro -%}

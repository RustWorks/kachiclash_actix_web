{% extends "base.html" %}

{% block main_id %}p-index{% endblock %}

{% block head %}
    <link rel="stylesheet" href="/static/css/index.css">
{% endblock %}

{% block main %}
    <a id="g-hero" href="/"></a>

    {% match current_basho %}
    {% when Some with (basho) %}
        <section id="next-basho">
            <a href="{{basho.link_url()}}">
                <img class="button-link"
                    alt="Enter current tournament"
                    src="/static/img2/2021-Current-Tournament.png"
                    width="1801" height="388">
            </a>
            {% if !basho.has_started() %}
                <p>
                    Time remaining to enter your picks:
                    <span class="js-basho-count-down" data-start-date="{{basho.start_date.timestamp_millis()}}"></span>
                </p>
            {% endif %}
        </section>
    {% when None %}
        {% if base.is_admin() %}
            <p>Admin: <a href="{{next_basho_id.url_path()}}/edit">enter banzuke for {{next_basho_id}}</a></p>
        {% endif %}
    {% endmatch %}

    {% match prev_basho %}
    {% when Some with (basho) %}
        <section id="prev-winners">
            <h2>
                <a href="{{basho.link_url()}}">
                    <img src="/static/img2/2021-Basho-Champion.png"
                        width="1801" height="448"
                        alt="Congratulations to the previous basho champion">
                </a>
            </h2>
            <span class="winners">
                {% for player in basho.winners -%}
                    {{player.render().unwrap()|safe}}
                    {%- if !loop.last %}, {% endif -%}
                {%- endfor %}
            </span>
        </section>
    {% when None %}
    {% endmatch %}

    <section id="leaderboard">
        <picture class="background">
            <source src="/static/img2/2021-Player-Rankings.webp" type="image/webp">
            <img src="/static/img2/2021-Player-Rankings.png" width="1059" height="1301">
        </picture>
        
        <div class="scroll-container">
            <table class="leaderboard">
                <thead>
                    <tr>
                        <th rowspan="2">Rank</th>
                        <th rowspan="2">Player</th>
                        <th colspan="3" class="border-left">Basho Ranks</th>
                        <th colspan="4" class="border-left">Wins</th>
                    </tr>
                    <tr>
                        <th class="border-left">best</th>
                        <th>worst</th>
                        <th>avg</th>
                        <th class="border-left">most</th>
                        <th>least</th>
                        <th>avg</th>
                        <th>total</th>
                    </tr>
                </thead>
                <tbody>
                {% for leader in leaders %}
                    <tr>
                        <td class="rank">{{leader.rank}}</td>
                        <td>{{leader.player.render().unwrap()|safe}}</td>
                        <td class="num border-left">{% call numeric_stat(leader.ranks.min) %}</td>
                        <td class="num">{% call numeric_stat(leader.ranks.max) %}</td>
                        <td class="num">{% call numeric_stat(leader.ranks.mean) %}</td>
                        <td class="num border-left">{% call numeric_stat(leader.wins.max) %}</td>
                        <td class="num">{% call numeric_stat(leader.wins.min) %}</td>
                        <td class="num">{% call numeric_stat(leader.wins.mean) %}</td>
                        <td class="num sort-key">{% call numeric_stat(leader.wins.total) %}</td>
                    </tr>
                {% endfor %}
                    
                </tbody>
            </table>
        </div>
    </section>
{% endblock %}

{%- macro numeric_stat(opt_num) -%}
    {%- match opt_num -%}
    {%- when Some with (num) -%} {{"{:.1}"|format(num)}}
    {%- when None -%}
    {%- endmatch -%}
{%- endmacro -%}

